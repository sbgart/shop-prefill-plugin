# –ö–æ–Ω—Ü–µ–ø—Ü–∏—è: –ü–æ–∫—É–ø–∫–∞ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫ (One-Click Buy)

> **–°—Ç–∞—Ç—É—Å:** –ö–æ–Ω—Ü–µ–ø—Ü–∏—è  
> **–î–∞—Ç–∞:** 2026-01-24  
> **–í–µ—Ä—Å–∏—è:** 1.0

---

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è checkout –∏ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ–∫—Ü–∏–π, —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ñ–æ—Ä–º–ª—è—Ç—å –∑–∞–∫–∞–∑—ã –±—É–∫–≤–∞–ª—å–Ω–æ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫. –õ–æ–≥–∏—á–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ø–ª–∞–≥–∏–Ω —Ñ—É–Ω–∫—Ü–∏–µ–π "–ü–æ–∫—É–ø–∫–∞ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫", –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –∏ —Å—Ä–∞–∑—É –ø–µ—Ä–µ–π—Ç–∏ –∫ checkout —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏.

**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â—É—é –ø–æ–∫—É–ø–∫—É –≤ –æ–¥–∏–Ω –∫–ª–∏–∫, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–µ –Ω—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω—è—Ç—å –Ω–∏–∫–∞–∫–∏–µ –ø–æ–ª—è ‚Äî —Ç–æ–ª—å–∫–æ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ö—É–ø–∏—Ç—å" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞ –∏ "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑" –Ω–∞ checkout.

---

## –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ Shop-Script API

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ—Ä–∑–∏–Ω—ã

**–ö–ª–∞—Å—Å:** `shopCart`  
**–•—Ä–∞–Ω–µ–Ω–∏–µ:** –¢–∞–±–ª–∏—Ü–∞ `shop_cart_items`  
**–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** –£–Ω–∏–∫–∞–ª—å–Ω—ã–π `code` (MD5 —Ö–µ—à) –≤ cookie `shop_cart`

```php
// –ö–æ—Ä–∑–∏–Ω–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ code
$cart = new shopCart($code);

// –í—Å–µ —Ç–æ–≤–∞—Ä—ã –≤ –ë–î –∏–º–µ—é—Ç —ç—Ç–æ—Ç code
// shop_cart_items: [id, code, product_id, sku_id, quantity, ...]
```

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `addItem($item, $services)` | –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É |
| `clear()` | –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∫–æ—Ä–∑–∏–Ω—É |
| `items($hierarchy)` | –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã |
| `generateCode()` | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ code |

### –ü—Ä–æ–±–ª–µ–º–∞ –∏–∑–æ–ª—è—Ü–∏–∏

**–í–æ–ø—Ä–æ—Å:** –ú–æ–∂–Ω–æ –ª–∏ –≤—ã–≤–µ—Å—Ç–∏ checkout —Å –æ–¥–Ω–∏–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ç–æ–≤–∞—Ä–æ–º, –Ω–µ —Ç—Ä–æ–≥–∞—è –æ—Å–Ω–æ–≤–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É?

**–û—Ç–≤–µ—Ç:** –ù–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –∏–∑–æ–ª—è—Ü–∏–∏. Shop-Script —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –æ–¥–Ω–æ–π –∫–æ—Ä–∑–∏–Ω–æ–π (–æ–¥–Ω–∏–º `code`) –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚ùå –í–∞—Ä–∏–∞–Ω—Ç 2: Backup –∏ Restore (–æ—Ç–∫–ª–æ–Ω–µ–Ω)

**–ò–¥–µ—è:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ —Ç–æ–≤–∞—Ä—ã ‚Üí –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä ‚Üí –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ –∑–∞–∫–∞–∑–∞.

**–ú–∏–Ω—É—Å—ã:**
- –†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–±–æ–µ
- –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –ù—É–∂–Ω–æ —Ç–æ—á–Ω–æ –≤–æ—Å—Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤ (services, quantity, etc.)

---

### ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 1: –í—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞ (–≤—ã–±—Ä–∞–Ω)

**–ò–¥–µ—è:** –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `code` –¥–ª—è one-click –∫–æ—Ä–∑–∏–Ω—ã, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è checkout, –∑–∞—Ç–µ–º –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ—Ä–∑–∏–Ω–µ.

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è:** –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞ –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç—Å—è –≤–æ–æ–±—â–µ
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π API Shop-Script
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ù–µ—Ç —Ä–∏—Å–∫–∞ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ—Ä–∑–∏–Ω—ã
- ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** Prefill –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ—Ä–∑–∏–Ω–æ–π
- ‚úÖ **–ö–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å:** –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω compact mode ‚Äî —á–µ–∫–∞—É—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π
- ‚úÖ **–ú–Ω–æ–≥–æ–≤–∫–ª–∞–¥–æ—á–Ω–æ—Å—Ç—å:** –ü—Ä–æ–±–ª–µ–º—ã –º–∏–Ω–∏–º–∞–ª—å–Ω—ã (–æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ session)

#### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

- ‚ö†Ô∏è –ù—É–∂–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ—Ä–∑–∏–Ω –≤ –ë–î (cron –∏–ª–∏ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏)
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã –ø–æ–∫—É–ø–∫–∏ (–∫–Ω–æ–ø–∫–∞ "–í–µ—Ä–Ω—É—Ç—å—Å—è")

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí "–ö—É–ø–∏—Ç—å –≤ –æ–¥–∏–Ω –∫–ª–∏–∫" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞
   ‚Üì
2. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π code –∫–æ—Ä–∑–∏–Ω—ã –≤ session: 'shop/oneclickbackup'
   ‚Üì
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π –≤—Ä–µ–º–µ–Ω–Ω—ã–π code
   ‚Üì
4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º cookie 'shop_cart' = temp_code
   ‚Üì
5. –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É: new shopCart(temp_code)
   ‚Üì
6. –î–æ–±–∞–≤–ª—è–µ–º –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –≤ –≤—Ä–µ–º–µ–Ω–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É
   ‚Üì
7. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥: wa()->getStorage()->set('shop/oneclick_mode', true)
   ‚Üì
8. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ checkout
   ‚Üì
9. Checkout –≤–∏–¥–∏—Ç –¢–û–õ–¨–ö–û –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä (–∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ—Ä–∑–∏–Ω—ã)
   ‚Üì
10. Prefill –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª—è
   ‚Üì
11. Compact mode (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω) —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Å–µ–∫—Ü–∏–∏
   ‚Üì
12. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑"
   ‚Üì
13. –°–æ–±—ã—Ç–∏–µ order_action.create
   ‚Üì
14. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π code –∏–∑ 'shop/oneclickbackup'
   ‚Üì
15. –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   ‚Üì
16. –£–¥–∞–ª—è–µ–º —Ñ–ª–∞–≥–∏: oneclick_mode, oneclickbackup
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–Ω–µ –æ—Ñ–æ—Ä–º–∏–ª –∑–∞–∫–∞–∑**, –Ω—É–∂–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∏—Ç—å / –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–æ—Ä–∑–∏–Ω–µ":

```
1. –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∏—Ç—å" –Ω–∞ checkout
   ‚Üì
2. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä shopPrefillPluginFrontendCancelOneClick
   ‚Üì
3. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π code
   ‚Üì
4. –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É
   ‚Üì
5. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É
```

---

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä: One-Click –∏–Ω–∏—Ü–∏–∞—Ü–∏—è

**–ü—É—Ç—å:** `lib/actions/frontend/shopPrefillPluginFrontendOneClick.controller.php`

```php
class shopPrefillPluginFrontendOneClickController extends waJsonController
{
    public function execute()
    {
        // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–æ–≤–∞—Ä–∞
        $product_id = waRequest::post('product_id', 0, waRequest::TYPE_INT);
        $sku_id = waRequest::post('sku_id', 0, waRequest::TYPE_INT);
        $quantity = waRequest::post('quantity', 1);
        $services = waRequest::post('services', []);
        
        if (!$product_id || !$sku_id) {
            throw new waException('Invalid product parameters');
        }
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–∞
        $product_model = new shopProductModel();
        $sku_model = new shopProductSkusModel();
        
        $product = $product_model->getById($product_id);
        $sku = $sku_model->getById($sku_id);
        
        if (!$product || !$sku || !$sku['available']) {
            throw new waException('Product not available');
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É
        $original_code = waRequest::cookie('shop_cart');
        if ($original_code) {
            wa()->getStorage()->set('shop/oneclick_backup', $original_code);
        }
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π code
        $temp_code = shopCart::generateCode();
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º cookie
        $cookie_expire = time() + 3600; // 1 —á–∞—Å (–¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ—Ä–∑–∏–Ω—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
        wa()->getResponse()->setCookie('shop_cart', $temp_code, $cookie_expire, null, '', false, true);
        
        // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É
        $temp_cart = new shopCart($temp_code);
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä
        $item = [
            'product_id' => $product_id,
            'sku_id' => $sku_id,
            'quantity' => $quantity,
            'type' => 'product'
        ];
        
        $data_services = [];
        if ($services) {
            foreach ($services as $service_id => $variant_id) {
                $data_services[] = [
                    'service_id' => $service_id,
                    'service_variant_id' => $variant_id,
                ];
            }
        }
        
        $temp_cart->addItem($item, $data_services);
        
        // –§–ª–∞–≥ one-click —Ä–µ–∂–∏–º–∞
        wa()->getStorage()->set('shop/oneclick_mode', true);
        wa()->getStorage()->set('shop/oneclick_temp_code', $temp_code);
        
        // URL –¥–ª—è checkout
        $checkout_url = wa()->getRouteUrl('shop/frontend/checkout');
        
        $this->response = [
            'redirect' => $checkout_url
        ];
    }
}
```

### 2. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä: –û—Ç–º–µ–Ω–∞ One-Click

**–ü—É—Ç—å:** `lib/actions/frontend/shopPrefillPluginFrontendCancelOneClick.controller.php`

```php
class shopPrefillPluginFrontendCancelOneClickController extends waJsonController
{
    public function execute()
    {
        if (!wa()->getStorage()->get('shop/oneclick_mode')) {
            throw new waException('Not in one-click mode');
        }
        
        // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É
        $temp_code = wa()->getStorage()->get('shop/oneclick_temp_code');
        if ($temp_code) {
            $temp_cart = new shopCart($temp_code);
            $temp_cart->clear();
        }
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É
        $original_code = wa()->getStorage()->get('shop/oneclick_backup');
        if ($original_code) {
            $cookie_expire = time() + 30 * 86400; // 30 –¥–Ω–µ–π
            wa()->getResponse()->setCookie('shop_cart', $original_code, $cookie_expire, null, '', false, true);
        }
        
        // –û—á–∏—â–∞–µ–º —Ñ–ª–∞–≥–∏
        wa()->getStorage()->remove('shop/oneclick_mode');
        wa()->getStorage()->remove('shop/oneclick_backup');
        wa()->getStorage()->remove('shop/oneclick_temp_code');
        
        // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –∫–æ—Ä–∑–∏–Ω—É
        $cart_url = wa()->getRouteUrl('shop/frontend/cart');
        
        $this->response = [
            'redirect' => $cart_url
        ];
    }
}
```

### 3. –•—É–∫: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–∫–∞–∑–∞

**–ü—É—Ç—å:** –í –æ—Å–Ω–æ–≤–Ω–æ–º –∫–ª–∞—Å—Å–µ –ø–ª–∞–≥–∏–Ω–∞ `lib/shopPrefill.plugin.php`

```php
public function orderActionCreate($params)
{
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —ç—Ç–æ one-click –∑–∞–∫–∞–∑
    if (!wa()->getStorage()->get('shop/oneclick_mode')) {
        return;
    }
    
    $temp_code = wa()->getStorage()->get('shop/oneclick_temp_code');
    
    // –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É
    if ($temp_code) {
        $temp_cart = new shopCart($temp_code);
        $temp_cart->clear();
    }
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É
    $original_code = wa()->getStorage()->get('shop/oneclick_backup');
    if ($original_code) {
        $cookie_expire = time() + 30 * 86400; // 30 –¥–Ω–µ–π
        wa()->getResponse()->setCookie('shop_cart', $original_code, $cookie_expire, null, '', false, true);
    } else {
        // –ï—Å–ª–∏ –Ω–µ –±—ã–ª–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –∫–æ—Ä–∑–∏–Ω—ã ‚Äî –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è–µ–º cookie
        wa()->getResponse()->deleteCookie('shop_cart');
    }
    
    // –û—á–∏—â–∞–µ–º —Ñ–ª–∞–≥–∏
    wa()->getStorage()->remove('shop/oneclick_mode');
    wa()->getStorage()->remove('shop/oneclick_backup');
    wa()->getStorage()->remove('shop/oneclick_temp_code');
}
```

### 4. JavaScript: –ö–Ω–æ–ø–∫–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

**–ü—É—Ç—å:** `js/frontend.js` (–¥–æ–±–∞–≤–∏—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)

```javascript
/**
 * One-Click Buy
 */
var PrefillOneClick = (function($) {
    'use strict';
    
    return {
        init: function() {
            $(document).on('click', '.js-one-click-buy', this.handleClick.bind(this));
        },
        
        handleClick: function(e) {
            e.preventDefault();
            
            var $btn = $(e.currentTarget);
            var productId = $btn.data('product-id');
            var skuId = $btn.data('sku-id');
            var quantity = $btn.data('quantity') || 1;
            
            if (!productId || !skuId) {
                console.error('One-Click: Missing product or sku ID');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            $btn.prop('disabled', true).addClass('loading');
            
            // AJAX –∑–∞–ø—Ä–æ—Å
            $.post('?plugin=prefill&action=oneclick', {
                product_id: productId,
                sku_id: skuId,
                quantity: quantity
            })
            .done(function(response) {
                if (response.status === 'ok' && response.data && response.data.redirect) {
                    window.location = response.data.redirect;
                } else {
                    console.error('One-Click: Invalid response', response);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞');
                    $btn.prop('disabled', false).removeClass('loading');
                }
            })
            .fail(function(xhr) {
                console.error('One-Click: Request failed', xhr);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞');
                $btn.prop('disabled', false).removeClass('loading');
            });
        }
    };
})(jQuery);

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
jQuery(function() {
    PrefillOneClick.init();
});
```

### 5. –®–∞–±–ª–æ–Ω: –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å –≤ –æ–¥–∏–Ω –∫–ª–∏–∫"

**–ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ —Ç–µ–º—É:**

```html
<!-- –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞ -->
<button class="js-one-click-buy btn btn-primary"
        data-product-id="{$product.id}"
        data-sku-id="{$product.sku_id}"
        data-quantity="1">
    <i class="fas fa-bolt"></i> –ö—É–ø–∏—Ç—å –≤ –æ–¥–∏–Ω –∫–ª–∏–∫
</button>
```

### 6. –®–∞–±–ª–æ–Ω: –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∏—Ç—å" –Ω–∞ checkout

**–ü—É—Ç—å:** –ß–µ—Ä–µ–∑ —Ö—É–∫ `checkout_render_*` –∏–ª–∏ —à–∞–±–ª–æ–Ω

```html
{if $wa->storage()->get('shop/oneclick_mode')}
    <div class="prefill-oneclick-cancel">
        <button class="js-cancel-oneclick btn btn-link">
            ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–æ—Ä–∑–∏–Ω–µ
        </button>
    </div>
    
    <script>
    jQuery('.js-cancel-oneclick').on('click', function(e) {
        e.preventDefault();
        $.post('?plugin=prefill&action=canceloneclick', function(r) {
            if (r.status === 'ok' && r.data && r.data.redirect) {
                window.location = r.data.redirect;
            }
        });
    });
    </script>
{/if}
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prefill

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞

**One-Click –∫–æ—Ä–∑–∏–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å prefill**, –ø–æ—Ç–æ–º—É —á—Ç–æ:

1. ‚úÖ –í—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞ ‚Äî —ç—Ç–æ –æ–±—ã—á–Ω–∞—è `shopCart` —Å –Ω–æ–≤—ã–º `code`
2. ‚úÖ Checkout —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º (cookie `shop_cart`)
3. ‚úÖ Prefill –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ cookie/session/–∑–∞–∫–∞–∑–æ–≤ ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ `code`
4. ‚úÖ –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ** –æ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∫–æ—Ä–∑–∏–Ω—ã

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Compact Mode

–ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω **–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º** (COLLAPSIBLE-SECTIONS):

```
Checkout –ø—Ä–∏ one-click –ø–æ–∫—É–ø–∫–µ:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚òë –¢–æ–≤–∞—Ä: iPhone 15 Pro  1 —à—Ç.     ‚îÇ ‚Üê –û–¥–∏–Ω —Ç–æ–≤–∞—Ä
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üë§ –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ ‚Ä¢ +7 999 123-45-67 ‚îÇ ‚Üê –°–≤–µ—Ä–Ω—É—Ç–∞—è —Å–µ–∫—Ü–∏—è
‚îÇ    [–ò–∑–º–µ–Ω–∏—Ç—å ‚ñº]                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üìç –ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞ 15           ‚îÇ ‚Üê –°–≤–µ—Ä–Ω—É—Ç–∞—è —Å–µ–∫—Ü–∏—è
‚îÇ    [–ò–∑–º–µ–Ω–∏—Ç—å ‚ñº]                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üöö –°–î–≠–ö –ö—É—Ä—å–µ—Ä                     ‚îÇ ‚Üê –°–≤–µ—Ä–Ω—É—Ç–∞—è —Å–µ–∫—Ü–∏—è
‚îÇ    [–ò–∑–º–µ–Ω–∏—Ç—å ‚ñº]                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ [–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑] ‚Üê 1 –∫–ª–∏–∫!         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–≠—Ç–æ –∏ –µ—Å—Ç—å –Ω–∞—Å—Ç–æ—è—â–∞—è –ø–æ–∫—É–ø–∫–∞ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫!**

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞–≥–∏–Ω–∞

### –ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ "–ü–æ–∫—É–ø–∫–∞ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫"

–î–æ–±–∞–≤–∏—Ç—å –≤ `storefront.settings.php`:

```php
'oneclick' => [
    'active' => [
        'value' => false,
        'filter' => FILTER_VALIDATE_BOOLEAN,
    ],
    
    'button_text' => [
        'value' => '‚ö° –ö—É–ø–∏—Ç—å –≤ –æ–¥–∏–Ω –∫–ª–∏–∫',
        'filter' => FILTER_SANITIZE_STRING,
    ],
    
    'clear_temp_carts' => [
        'value' => true,
        'filter' => FILTER_VALIDATE_BOOLEAN,
    ],
    
    'temp_cart_lifetime' => [
        'value' => 3600, // 1 —á–∞—Å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
        'filter' => FILTER_VALIDATE_INT,
    ],
],
```

### UI –Ω–∞—Å—Ç—Ä–æ–µ–∫

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚òë –í–∫–ª—é—á–∏—Ç—å "–ü–æ–∫—É–ø–∫—É –≤ –æ–¥–∏–Ω –∫–ª–∏–∫"                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏:                                        ‚îÇ
‚îÇ [‚ö° –ö—É–ø–∏—Ç—å –≤ –æ–¥–∏–Ω –∫–ª–∏–∫                              ]‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ ‚òë –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã           ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∫–æ—Ä–∑–∏–Ω—ã:                       ‚îÇ
‚îÇ [3600] —Å–µ–∫—É–Ω–¥ (1 —á–∞—Å)                               ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ ‚ÑπÔ∏è  –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏        ‚îÇ
‚îÇ    one-click –ø–æ–∫—É–ø–æ–∫ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ—Ä–∑–∏–Ω—ã.            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ—Ä–∑–∏–Ω

### –ü—Ä–æ–±–ª–µ–º–∞

–í—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ë–î –≤ `shop_cart_items`. –ù—É–∂–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º –æ—á–∏—Å—Ç–∫–∏.

### –†–µ—à–µ–Ω–∏–µ 1: –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ (–ø—Ä–æ—Å—Ç–æ–µ)

```php
// –í —Ö—É–∫–µ orderActionCreate –∏–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ cancelOneClick
if ($temp_code) {
    $temp_cart = new shopCart($temp_code);
    $temp_cart->clear(); // –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Å —ç—Ç–∏–º code
}
```

**–ü–ª—é—Å—ã:** –ü—Ä–æ—Å—Ç–æ—Ç–∞  
**–ú–∏–Ω—É—Å—ã:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫—Ä—ã–ª –≤–∫–ª–∞–¥–∫—É ‚Äî –∫–æ—Ä–∑–∏–Ω–∞ –æ—Å—Ç–∞–ª–∞—Å—å –≤ –ë–î

### –†–µ—à–µ–Ω–∏–µ 2: Cron –∑–∞–¥–∞—á–∞ (–Ω–∞–¥–µ–∂–Ω–æ–µ)

**–ü—É—Ç—å:** `lib/cli/shopPrefillPluginCleanupCarts.cli.php`

```php
class shopPrefillPluginCleanupCartsCli extends waCliController
{
    public function execute()
    {
        $settings = shopPrefillPluginHelper::getStorefrontSettings();
        
        if (!$settings['oneclick']['active']) {
            return;
        }
        
        $lifetime = $settings['oneclick']['temp_cart_lifetime'];
        $threshold = date('Y-m-d H:i:s', time() - $lifetime);
        
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã
        $model = new shopCartItemsModel();
        
        // –ù–∞–π—Ç–∏ code –∫–æ—Ä–∑–∏–Ω, –∫–æ—Ç–æ—Ä—ã–µ:
        // 1. –ù–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (contact_id = NULL –∏–ª–∏ 0)
        // 2. –°—Ç–∞—Ä—à–µ $threshold
        $sql = "DELETE FROM shop_cart_items 
                WHERE create_datetime < s:threshold 
                AND (contact_id IS NULL OR contact_id = 0)";
        
        $deleted = $model->exec($sql, ['threshold' => $threshold]);
        
        $this->log("Cleaned up {$deleted} temporary cart items");
    }
}
```

**–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ crontab:**

```bash
*/10 * * * * php /path/to/wa-dev/cli.php shop prefillPluginCleanupCarts
```

### –†–µ—à–µ–Ω–∏–µ 3: –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ—Ä–∑–∏–Ω

–î–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ –≤ session –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏:

```php
wa()->getStorage()->set('shop/oneclick_temp_codes', [
    $temp_code => time()
]);

// –ü—Ä–∏ cleanup –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–æ–ª—å–∫–æ —ç—Ç–∏ code
```

**–ú–∏–Ω—É—Å:** –ï—Å–ª–∏ session –∏—Å—Ç–µ–∫ ‚Äî –ø–æ—Ç–µ—Ä—è–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ—Ä–∑–∏–Ω–∞—Ö.

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫—Ä—ã–ª –≤–∫–ª–∞–¥–∫—É –±–µ–∑ –∑–∞–∫–∞–∑–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞ –æ—Å—Ç–∞–ª–∞—Å—å –≤ –ë–î, –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- Cron –∑–∞–¥–∞—á–∞ –æ—á–∏—â–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã
- –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤–∏–∑–∏—Ç–µ cookie `shop_cart` –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω (–ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π –∫–æ—Ä–∑–∏–Ω—ã)

### 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∫–ª–∞–¥–æ–∫

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
- –í–∫–ª–∞–¥–∫–∞ 1: –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞ (code_A)
- –í–∫–ª–∞–¥–∫–∞ 2: One-Click (code_B)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- Cookie `shop_cart` –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `code_B` (one-click)
- –í–∫–ª–∞–¥–∫–∞ 1 —Ç–µ–ø–µ—Ä—å —Ç–æ–∂–µ –≤–∏–¥–∏—Ç `code_B`

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:

```javascript
// –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞—Ü–∏–∏ one-click
if (document.hidden) {
    // –í–∫–ª–∞–¥–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞ ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç—å
    confirm('–£ –≤–∞—Å –æ—Ç–∫—Ä—ã—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∫–ª–∞–¥–æ–∫. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?');
}
```

### 3. –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–∫–∞–∑ –Ω–µ —Å–æ–∑–¥–∞–Ω, –Ω–æ —Ö—É–∫ `order_action.create` –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å timeout –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:

```javascript
// –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ checkout
setTimeout(function() {
    // –ï—Å–ª–∏ —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç –≤—Å–µ –µ—â–µ –≤ oneclick_mode ‚Äî —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏?
}, 600000);
```

–ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ñ–ª–∞–≥ `oneclick_mode` –ø—Ä–∏ –ª—é–±–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É".

### 4. –¢–æ–≤–∞—Ä –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –≤–æ –≤—Ä–µ–º—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–ö—É–ø–∏—Ç—å –≤ –æ–¥–∏–Ω –∫–ª–∏–∫", –Ω–æ –∫ –º–æ–º–µ–Ω—Ç—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä —Å—Ç–∞–ª unavailable.

**–†–µ—à–µ–Ω–∏–µ:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è Shop-Script –Ω–∞ checkout —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –ø–æ–∫–∞–∂–µ—Ç –æ—à–∏–±–∫—É. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å "–û—Ç–º–µ–Ω–∏—Ç—å" –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è.

---

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –°–æ–±—ã—Ç–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

1. `prefill_oneclick_initiated` ‚Äî –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É
2. `prefill_oneclick_checkout_opened` ‚Äî –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ checkout
3. `prefill_oneclick_order_created` ‚Äî –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω
4. `prefill_oneclick_cancelled` ‚Äî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª

```php
// –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
wa('shop')->event('prefill_oneclick_initiated', [
    'product_id' => $product_id,
    'sku_id' => $sku_id,
]);
```

### –ö–æ–Ω–≤–µ—Ä—Å–∏—è

–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:
- –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å –≤ –æ–¥–∏–Ω –∫–ª–∏–∫"
- –°–∫–æ–ª—å–∫–æ –∑–∞–∫–∞–∑–æ–≤ –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ —á–µ—Ä–µ–∑ one-click
- **CR = –ó–∞–∫–∞–∑—ã / –ö–ª–∏–∫–∏**

–°—Ä–∞–≤–Ω–∏—Ç—å —Å –æ–±—ã—á–Ω–æ–π –∫–æ—Ä–∑–∏–Ω–æ–π –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

---

## –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: MVP

1. [ ] –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä `shopPrefillPluginFrontendOneClick.controller.php`
2. [ ] –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä `shopPrefillPluginFrontendCancelOneClick.controller.php`
3. [ ] –•—É–∫ `order_action.create` –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã
4. [ ] JavaScript –¥–ª—è –∫–Ω–æ–ø–∫–∏ `.js-one-click-buy`
5. [ ] Routing –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
6. [ ] –ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç–æ–≤–∞—Ä ‚Üí checkout ‚Üí –∑–∞–∫–∞–∑ ‚Üí –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ)

### –§–∞–∑–∞ 2: UI –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞–≥–∏–Ω–∞: `oneclick` —Å–µ–∫—Ü–∏—è
2. [ ] UI –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏
3. [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏
4. [ ] –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∏—Ç—å" –Ω–∞ checkout
5. [ ] –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫

### –§–∞–∑–∞ 3: –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

1. [ ] Cron –∑–∞–¥–∞—á–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ—Ä–∑–∏–Ω
2. [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases (–Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∫–ª–∞–¥–æ–∫, –æ—à–∏–±–∫–∏)
3. [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `shopPrefillPluginLog`)
4. [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ—Ä–∑–∏–Ω

### –§–∞–∑–∞ 4: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

1. [ ] –°–æ–±—ã—Ç–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º–µ—Ç—Ä–∏–∫
2. [ ] –î–∞—à–±–æ—Ä–¥ –≤ –∞–¥–º–∏–Ω–∫–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Analytics / –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [CONCEPT.md](CONCEPT.md) ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞
- [COLLAPSIBLE-SECTIONS.md](COLLAPSIBLE-SECTIONS.md) ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º checkout
- [TODO.md](../TODO.md) ‚Äî –∑–∞–¥–∞—á–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

## –û—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ç–µ–º–∞–º–∏:** –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ö—É–ø–∏—Ç—å –≤ –æ–¥–∏–Ω –∫–ª–∏–∫" –≤ —Ä–∞–∑–Ω—ã–µ —Ç–µ–º—ã?
   - –•—É–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞?
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Ç–µ–º?

2. **–ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è:** –ù—É–∂–Ω—ã –ª–∏ –æ—Ç–ª–∏—á–∏—è –≤ UX –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤?

3. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è screen readers –∏ keyboard navigation.

4. **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è:** –ü–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤ (`locale/`).

5. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å –¥—Ä—É–≥–∏–º–∏ –ø–ª–∞–≥–∏–Ω–∞–º–∏:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –ø–ª–∞–≥–∏–Ω–∞–º–∏ –∫–æ—Ä–∑–∏–Ω—ã.

---

## –í—ã–≤–æ–¥—ã

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è "–ü–æ–∫—É–ø–∫–∏ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫" —á–µ—Ä–µ–∑ **–≤—Ä–µ–º–µ–Ω–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É** ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

1. ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
2. ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–∏–∑–æ–ª—è—Ü–∏—è –∫–æ—Ä–∑–∏–Ω)
3. ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å prefill –∏ compact mode
4. ‚úÖ –ù–∞—Å—Ç–æ—è—â–∏–π "–æ–¥–∏–Ω –∫–ª–∏–∫" –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–°–∏–Ω–µ—Ä–≥–∏—è —Å –ø–ª–∞–≥–∏–Ω–æ–º Prefill:**
- –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ + –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º + One-Click = **–ò–¥–µ–∞–ª—å–Ω—ã–π UX –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫**
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è –º–æ–∂–µ—Ç –≤—ã—Ä–∞—Å—Ç–∏ –Ω–∞ 50%+ (–ø–æ –¥–∞–Ω–Ω—ã–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π one-click –ø–æ–∫—É–ø–æ–∫)

---

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!** üöÄ
