# –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π –ø–µ—Ä–µ–¥ —Å–∫—Ä—ã—Ç–∏–µ–º

Shop-Script –∏–º–µ–µ—Ç **3 —Ç–∏–ø–∞ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–µ—Ä–µ–¥ —Å–∫—Ä—ã—Ç–∏–µ–º –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã.

## –¢–∏–ø—ã –æ—à–∏–±–æ–∫

### 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `$params['errors']`, `$params['error_step_id']`

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –ë–ª–æ–∫–∏—Ä—É—é—Ç –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ checkout
- –í–ª–∏—è—é—Ç –Ω–∞ —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏/–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
- –ü–æ—è–≤–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–ü—Ä–∏–º–µ—Ä—ã –ø–æ–ª–µ–π:** –ì–æ—Ä–æ–¥, –°—Ç—Ä–∞–Ω–∞, –†–µ–≥–∏–æ–Ω

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```php
$params['errors'] = [
    [
        'name'    => 'region[city]',
        'text'    => '–≠—Ç–æ –ø–æ–ª–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.',
        'section' => 'region',
    ],
]
```

### 2. –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ (delayed_errors)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
- `$params['data']['auth']['delayed_errors']` - –ø–æ–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `$params['data']['details']['delayed_errors']` - –ø–æ–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –ù–ï –±–ª–æ–∫–∏—Ä—É—é—Ç –ø–æ–∫–∞–∑ –∫–Ω–æ–ø–∫–∏ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑"
- –ù–ï –≤–ª–∏—è—é—Ç –Ω–∞ —Ä–∞—Å—á–µ—Ç –¥–æ—Å—Ç–∞–≤–∫–∏
- –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
- –ü–æ—è–≤–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

**–ü—Ä–∏–º–µ—Ä—ã –ø–æ–ª–µ–π:** –¢–µ–ª–µ—Ñ–æ–Ω, –û—Ç—á–µ—Å—Ç–≤–æ, –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```php
$params['data']['auth']['delayed_errors'] = [
    'auth[data][phone]' => '–≠—Ç–æ –ø–æ–ª–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.',
]

$params['data']['details']['delayed_errors'] = [
    'details[shipping_address][zip]' => '–≠—Ç–æ –ø–æ–ª–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.',
]
```

### 3. –û—à–∏–±–∫–∏ —Å–æ–≥–ª–∞—Å–∏—è (service_agreement)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `$params['vars']['auth']['service_agreement']`

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- –ß–µ–∫–±–æ–∫—Å —Å–æ–≥–ª–∞—Å–∏—è —Å —É—Å–ª–æ–≤–∏—è–º–∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
- –ù–ï –ø–æ–ø–∞–¥–∞–µ—Ç –≤ `delayed_errors`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
- –ó–Ω–∞—á–µ–Ω–∏–µ `0` = –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω, `1` = —Å–æ–≥–ª–∞—Å–µ–Ω

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```php
$service_agreement_value = ifset($params, 'vars', 'auth', 'service_agreement', null);
if ($service_agreement_value !== null && $service_agreement_value == 0) {
    // –ù–ï–õ–¨–ó–Ø —Å–∫—Ä—ã–≤–∞—Ç—å —Ñ–æ—Ä–º—É - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–æ–≥–ª–∞—Å–∏–ª—Å—è
}
```

## –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—à–∏–±–æ–∫

### Helper –º–µ—Ç–æ–¥—ã

#### extractCheckoutErrors()

–ò–∑–≤–ª–µ–∫–∞–µ—Ç –≤—Å–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫ –∏–∑ `$params` –º–∞—Å—Å–∏–≤–∞:

```php
private function extractCheckoutErrors(array $params): array
{
    return [
        'has_errors'              => bool,   // –ï—Å—Ç—å –ª–∏ —Ö–æ—Ç—å –æ–¥–Ω–∞ –æ—à–∏–±–∫–∞
        'regular_errors'          => array,  // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
        'auth_delayed_errors'     => array,  // –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ auth
        'details_delayed_errors'  => array,  // –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ details
        'service_agreement_error' => bool,   // Service agreement
        'error_step_id'           => string, // ID —à–∞–≥–∞ —Å –æ—à–∏–±–∫–æ–π
    ];
}
```

#### renderErrorsDebugHtml()

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML –±–ª–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—à–∏–±–∫–∞—Ö:

```php
private function renderErrorsDebugHtml(array $errors_info, string $hook_name): string
{
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π debug –±–ª–æ–∫ —Å:
    // - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –æ—à–∏–±–∫–∞–º–∏ (–∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω)
    // - Auth delayed_errors (–∂–µ–ª—Ç—ã–π —Ñ–æ–Ω)
    // - Service agreement (—Ä–æ–∑–æ–≤—ã–π —Ñ–æ–Ω)
    // - Details delayed_errors (–∂–µ–ª—Ç—ã–π —Ñ–æ–Ω)
    // - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ —Ä–µ—à–µ–Ω–∏—é
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ö—É–∫–∞—Ö

–í—Å–µ checkout —Ö—É–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—É—é —Å–∏—Å—Ç–µ–º—É:

```php
public function checkoutRenderAuth(&$params)
{
    $errors_info = $this->extractCheckoutErrors($params);
    
    if (!$errors_info['has_errors']) {
        return ''; // –ù–µ—Ç –æ—à–∏–±–æ–∫ - –º–æ–∂–Ω–æ —Å–∫—Ä—ã–≤–∞—Ç—å —Ñ–æ—Ä–º—É
    }
    
    // –ï—Å—Ç—å –æ—à–∏–±–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    return $this->renderErrorsDebugHtml($errors_info, 'AUTH SECTION');
}
```

**–•—É–∫–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π:**
- `checkoutRenderAuth` - —Å–µ–∫—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `checkoutRenderRegion` - —Å–µ–∫—Ü–∏—è —Ä–µ–≥–∏–æ–Ω–∞
- `checkoutRenderShipping` - —Å–µ–∫—Ü–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏
- `checkoutRenderConfirm` - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚úÖ

### Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –æ—à–∏–±–æ–∫ –≤ –∫–∞–∂–¥–æ–π —Å–µ–∫—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:

```
‚ö†Ô∏è [SECTION NAME]: –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!

üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò (–±–ª–æ–∫–∏—Ä—É—é—Ç checkout):
‚Ä¢ region[city]: –≠—Ç–æ –ø–æ–ª–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.

üìù Auth errors (—Å–µ–∫—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏):
‚Ä¢ auth[data][phone]: –≠—Ç–æ –ø–æ–ª–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.

‚ö†Ô∏è Service Agreement (—á–µ–∫–±–æ–∫—Å —Å–æ–≥–ª–∞—Å–∏—è —Å —É—Å–ª–æ–≤–∏—è–º–∏):
‚Ä¢ auth[service_agreement]: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è

üöö Details errors (—Å–µ–∫—Ü–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏):
‚Ä¢ details[shipping_address][zip]: –≠—Ç–æ –ø–æ–ª–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.

üí° –†–µ—à–µ–Ω–∏–µ: –ù–µ —Å–∫—Ä—ã–≤–∞—Ç—å –±–ª–æ–∫–∏ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –õ–Æ–ë–´–• –æ—à–∏–±–æ–∫
```

## –í–∞–∂–Ω–æ

**–ü—Ä–æ–≤–µ—Ä—è–π –í–°–ï 3 —Ç–∏–ø–∞ –æ—à–∏–±–æ–∫!** –ò—Å–ø–æ–ª—å–∑—É–π `extractCheckoutErrors()` –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ –≤—Å–µ—Ö —Ö—É–∫–∞—Ö.

–ò–Ω–∞—á–µ –º–æ–∂–µ—à—å —Å–∫—Ä—ã—Ç—å:
- –ü–æ–ª–µ "–ì–æ—Ä–æ–¥" (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞)
- –ü–æ–ª–µ "–¢–µ–ª–µ—Ñ–æ–Ω" (–æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞)  
- –ß–µ–∫–±–æ–∫—Å "–°–æ–≥–ª–∞—Å–∏–µ —Å —É—Å–ª–æ–≤–∏—è–º–∏" (service_agreement)

–ò –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–º–æ–∂–µ—Ç –∏—Ö –∑–∞–ø–æ–ª–Ω–∏—Ç—å.
