# –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–ª–∞–≥–∏–Ω–∞ Prefill

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-01-08
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2026-01-08
**–í–µ—Ä—Å–∏—è:** 1.0.3

## –û–±–∑–æ—Ä

–ü–ª–∞–≥–∏–Ω **Prefill** –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–µ Shop-Script. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–∫—É–ø–∫–∏ –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –ø–æ–≤—ã—à–∞–µ—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏—é.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üéØ –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π –∑–∞–∫–∞–∑–∞

–ü–ª–∞–≥–∏–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è –≤ —Ñ–æ—Ä–º–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞:

- **–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - –∏–º—è, email, —Ç–µ–ª–µ—Ñ–æ–Ω
- **–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏** - —Å—Ç—Ä–∞–Ω–∞, —Ä–µ–≥–∏–æ–Ω, –≥–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞
- **–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏** - –≤—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

### üìä –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

–ü–ª–∞–≥–∏–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è:

1. **–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –∞–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–æ–∫—É–ø–æ–∫
2. **–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - –¥–∞–Ω–Ω—ã–µ –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
3. **–ö—É–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –≥–æ—Å—Ç–µ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏—Ç—Ä–∏–Ω—ã** - –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∏—Ç—Ä–∏–Ω—ã

### üè™ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ –≤–∏—Ç—Ä–∏–Ω–∞–º

–ü–ª–∞–≥–∏–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∏—Ç—Ä–∏–Ω—ã –º–∞–≥–∞–∑–∏–Ω–∞:

- –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ "–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è" –¥–ª—è –≥–æ—Å—Ç–µ–π
- –í—ã–±–æ—Ä –ø–æ–ª–µ–π –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
- –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è —Ü–≤–µ—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

### üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å checkout

–ü–ª–∞–≥–∏–Ω –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ Shop-Script:

- –•—É–∫ `frontend_order` - –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
- –•—É–∫ `frontend_head` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
- –•—É–∫ `checkout_result` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Å–µ–∫—Ü–∏–π
- –•—É–∫ `order_action.create` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

### ‚öôÔ∏è –ú–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã –∫–æ—Ä–∑–∏–Ω—ã

#### 1. –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤

–ü—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–ª–∞–≥–∏–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –µ–≥–æ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–∫–∞–∑—ã:

```php
// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
$orders_params = $this->getOrderProvider()->getUserOrdersParams($userId);

// –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º "shipping_"
$unique_orders_params = shopPrefillPluginFillParamsHelper::removeDuplicateSubarrays(
    $orders_params,
    "shipping_"
);
```

#### 2. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è

–°–æ–∑–¥–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç `shopPrefillPluginFillParams` —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –∑–∞–∫–∞–∑–æ–≤:

```php
$fill_params = new shopPrefillPluginFillParams();
$fill_params->setCountry($order_params['shipping_address.country']);
$fill_params->setCity($order_params['shipping_address.city']);
$fill_params->setShippingTypeId($order_params['shipping_type_id']);
$fill_params->setPaymentId($order_params['payment_id']);
$fill_params->setComment($order_params['comment']);
```

#### 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Å–µ—Å—Å–∏—é –∫–æ—Ä–∑–∏–Ω—ã

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Å–µ—Å—Å–∏–æ–Ω–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ Webasyst:

```php
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Å–µ—Å—Å–∏—é shop/checkout
$this->getSessionStorageProvider()->fillCheckoutParams($fill_params);

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–µ—Å—Å–∏–∏
[
    'order' => [
        'region' => [
            'country' => 'rus',
            'city' => '–ú–æ—Å–∫–≤–∞',
            'zip' => '123456'
        ],
        'shipping' => [
            'type_id' => 1,
            'variant_id' => '1.courier'
        ],
        'payment' => [
            'id' => 2
        ],
        'confirm' => [
            'comment' => '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É'
        ]
    ]
]
```

#### 4. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–µ

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã.

#### –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   frontendHead  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   getFillParams  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   fillCheckout  ‚îÇ
‚îÇ   (–≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)‚îÇ    ‚îÇ   (–∏–∑ –∏—Å—Ç–æ—Ä–∏–∏)   ‚îÇ    ‚îÇ   (–≤ —Å–µ—Å—Å–∏—é)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ
                                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  frontendOrder  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  getCheckout     ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ   ‚îÇ
‚îÇ  (—Å—Ç—Ä–∞–Ω–∏—Ü–∞      ‚îÇ    ‚îÇ   Params         ‚îÇ    ‚îÇ   –≤ —Ñ–æ—Ä–º–µ       ‚îÇ
‚îÇ   –∫–æ—Ä–∑–∏–Ω—ã)      ‚îÇ    ‚îÇ  (–∏–∑ —Å–µ—Å—Å–∏–∏)     ‚îÇ    ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –ó–∞—â–∏—Ç–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–ª–∞–≥–∏–Ω–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∏—Ç—Ä–∏–Ω—ã
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ–∫—Ü–∏–π –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ —Å–µ—Å—Å–∏—é
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ

### üíæ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è

#### –£—Ä–æ–≤–Ω–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

–ü–ª–∞–≥–∏–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

**1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–≤ –ø–∞–º—è—Ç–∏)**

```php
// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ FillParamsProvider
private ?shopPrefillPluginFillParamsCollection $fill_params_collection = null;

public function getFillParamsCollection(): shopPrefillPluginFillParamsCollection
{
    if ($this->fill_params_collection) {
        return $this->fill_params_collection; // –í–æ–∑–≤—Ä–∞—Ç –∏–∑ –∫—ç—à–∞
    }
    // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏...
}
```

**2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–Ω–∞ –¥–∏—Å–∫–µ)**

```php
// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ FillParamsStorage —Å –ø–æ–º–æ—â—å—é waSerializeCache
public function storeFillParams(shopPrefillPluginFillParams $fill_params): void
{
    $cache = new waSerializeCache($this->getFillParamsCachePath());
    $cache->set($fill_params);
}

public function getStoredFillParams(): ?shopPrefillPluginFillParams
{
    $cache = new waSerializeCache($this->getFillParamsCachePath());
    if ($cache->isCached()) {
        return $cache->get(); // –í–æ–∑–≤—Ä–∞—Ç –∏–∑ –∫—ç—à–∞
    }
    return null;
}
```

#### –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –∫—ç—à–∞

```php
public function getFillParams(?int $fill_params_id = null): shopPrefillPluginFillParams
{
    $stored_fill_params = $this->getFillParamsStorage()->getStoredFillParams();

    // –ï–°–õ–ò –∫—ç—à —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ò –Ω–µ –Ω—É–∂–Ω—ã —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí –≤–µ—Ä–Ω—É—Ç—å –∫—ç—à
    if (!$fill_params_id && $stored_fill_params) {
        return $stored_fill_params; // ‚ö° –ë—ã—Å—Ç—Ä—ã–π –≤–æ–∑–≤—Ä–∞—Ç –∏–∑ –∫—ç—à–∞!
    }

    // –ò–ù–ê–ß–ï ‚Üí —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –æ–±–Ω–æ–≤–∏—Ç—å –∫—ç—à
    // ... —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ...
    $this->getFillParamsStorage()->storeFillParams($fill_params);
    return $fill_params;
}
```

–ú–µ—Ç–æ–¥ `isCached()` –≤ `waSerializeCache` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:

- ‚úÖ **–°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ–∞–π–ª –∫—ç—à–∞**
- ‚úÖ **–ù–µ –∏—Å—Ç–µ–∫ –ª–∏ TTL** (–≤ –ø–ª–∞–≥–∏–Ω–µ TTL = -1, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å—Ç–µ–∫–∞–µ—Ç)

#### –ö–æ–≥–¥–∞ –∫—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

–ö—ç—à **–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** —Ç–æ–ª—å–∫–æ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ª—É—á–∞—è—Ö:

**‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

```php
// 1. –ö–æ–≥–¥–∞ –∫—ç—à-—Ñ–∞–π–ª –ù–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
$stored_fill_params = $this->getFillParamsStorage()->getStoredFillParams();
if (!$stored_fill_params) { // isCached() –≤–µ—Ä–Ω—É–ª false
    // –§–æ—Ä–º–∏—Ä—É–µ–º –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
    $this->getFillParamsStorage()->storeFillParams($fill_params);
}

// 2. –ö–æ–≥–¥–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ ID
public function getFillParams(?int $fill_params_id = null): shopPrefillPluginFillParams
{
    if ($fill_params_id && isset($fill_params_array[$fill_params_id])) {
        // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
        $this->getFillParamsStorage()->storeFillParams($fill_params);
    }
}
```

**‚ùå –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ù–ï –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏:**

- –ò–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
- –ò–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–∏—Ç—Ä–∏–Ω—ã
- –ü—Ä–æ—à–µ—Å—Ç–≤–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ (TTL = -1)

**üö® –ü—Ä–æ–±–ª–µ–º–∞:** –ö—ç—à –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã—Ö!

**3. –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è (–≤ —Å–µ—Å—Å–∏–∏)**

```php
// –§–ª–∞–≥ –≤ SessionStorageProvider
public bool $prefilled = false;

public function preFillCheckoutParams(shopPrefillPluginFillParams $params): void
{
    if ($this->prefilled) { // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã, —Ç–æ –≤—ã—Ö–æ–¥–∏–º.
        return;
    }
    // –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ...
    $this->prefilled = true;
}
```

#### –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**

```php
$fill_params_cache_id = 'user_' . $this->getUserProvider()->getId();
$fill_params_cache_id = hash('sha256', $fill_params_cache_id);
```

**–î–ª—è –≥–æ—Å—Ç–µ–π:**

```php
$fill_params_cache_id = 'guest_' . uniqid() . microtime(true);
$fill_params_cache_id = hash('sha256', $fill_params_cache_id);
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—É–∫–∏ –Ω–∞ 5 –º–∏–Ω—É—Ç
$this->getResponse()->setCookie('checkout_fill_params_cache_id', $fill_params_cache_id, time() + 300);
```

#### –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞

- **–ö–æ–ª–ª–µ–∫—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**: –≤ —Ç–µ—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ HTTP-–∑–∞–ø—Ä–æ—Å–∞ (request-scoped)
- **–§–∏–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**: –Ω–∞ –¥–∏—Å–∫–µ, TTL = -1 (–Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å—Ä–æ–∫)
- **–ö—É–∫–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞**: 5 –º–∏–Ω—É—Ç (–¥–ª—è –≥–æ—Å—Ç–µ–π)
- **–§–ª–∞–≥ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è**: –≤ —Ç–µ—á–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞

### ‚ö†Ô∏è –ö–æ–≥–¥–∞ –∫—ç—à —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–º

–ö—ç—à –ø–ª–∞–≥–∏–Ω–∞ **–Ω–µ –∏–º–µ–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏** –ø–æ TTL (TTL = -1). –û–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "—É—Å—Ç–∞—Ä–µ–≤—à–∏–º" —Ç–æ–ª—å–∫–æ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ª—É—á–∞—è—Ö:

#### 1. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –∫—ç—à–∞ (cache_id)

**–î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**

```php
// Cache ID –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ user_id
$cache_id = hash('sha256', 'user_' . $user_id);

// –ú–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏:
‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (guest_* ‚Üí user_*)
‚ùå –ò–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (user_id –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–µ–º –∂–µ)
‚ùå –ù–æ–≤–æ–º –∑–∞–∫–∞–∑–µ (user_id –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–µ–º –∂–µ)
```

**–î–ª—è –≥–æ—Å—Ç–µ–π:**

```php
// Cache ID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ + –∫—É–∫–∏ –Ω–∞ 5 –º–∏–Ω—É—Ç
$cache_id = hash('sha256', 'guest_' . uniqid() . microtime(true));
$this->getResponse()->setCookie('checkout_fill_params_cache_id', $cache_id, time() + 300);

// –ú–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏:
‚úÖ –ò—Å—Ç–µ—á–µ–Ω–∏–∏ –∫—É–∫–∏ (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
‚úÖ –ù–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞
‚ùå –ò–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö (–Ω–µ—Ç user_id)
```

#### 2. –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞

**–ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É Webasyst:**

```
Settings ‚Üí General settings ‚Üí Clear cache
```

**–ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:**

```php
// –ß–µ—Ä–µ–∑ –¥—Ä—É–≥–∏–µ –ø–ª–∞–≥–∏–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, Super Cache)
```

#### 3. –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∫—ç—à–∞

**–°–∏—Å—Ç–µ–º–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:**

```bash
# –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∫—ç—à–∞ –ø–ª–∞–≥–∏–Ω–∞
rm -rf wa-cache/*/apps/shop_prefill/
```

### üö® –ü—Ä–æ–±–ª–µ–º–∞: –∫—ç—à –Ω–µ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**

- ‚ùå –ö—ç—à –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞
- ‚ùå –ö—ç—à –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚ùå –ö—ç—à –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–∏—Ç—Ä–∏–Ω—ã
- ‚ùå –ù–µ—Ç TTL –¥–ª—è –¥–∏—Å–∫–æ–≤–æ–≥–æ –∫—ç—à–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å **—É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è** –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞:

- –ù–µ –∏—Å—Ç–µ—á–µ—Ç –∫—É–∫–∏ (–¥–ª—è –≥–æ—Å—Ç–µ–π)
- –ù–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è cache_id
- –ù–µ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Ä—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞

### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

–î–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞:

```php
// –í —Ö—É–∫–µ order_action.create - –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
public function orderActionCreate($data)
{
    // ... —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞ ...

    // –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
    $this->getFillParamsStorage()->clearStoredFillParams();
}
```

**‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:** –ú–µ—Ç–æ–¥ `clearStoredFillParams()` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `shopPrefillPluginFillParamsStorage`.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **shopPrefillPlugin** - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –ø–ª–∞–≥–∏–Ω–∞
- **FillParams** - —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
- **StorefrontProvider** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –≤–∏—Ç—Ä–∏–Ω
- **SessionStorage** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–µ—Å—Å–∏–∏
- **Checkout** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ—Ü–µ—Å—Å–æ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è

### –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞–≥–∏–Ω–∞ –∏ –≤–∏—Ç—Ä–∏–Ω
- **–°–µ—Å—Å–∏—è** - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
- **–ö—É–∫–∏** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ó–∞—â–∏—Ç–∞ –æ—Ç XSS –∏ SQL-–∏–Ω—ä–µ–∫—Ü–∏–π
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º GDPR

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
- –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- Shop-Script 8.0+
- PHP 7.4+
- MySQL 5.7+
- –°–æ–≤–º–µ—Å—Ç–∏–º —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏ –∏ –ø–ª–∞–≥–∏–Ω–∞–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2026-01-08
