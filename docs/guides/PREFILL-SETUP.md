# Настройка плагина Prefill

**Дата создания:** 2026-01-08
**Версия:** 1.0

## Быстрый старт

### 1. Установка плагина

1. Скачайте архив плагина из магазина Webasyst
2. Распакуйте в `wa-apps/shop/plugins/`
3. Установите через раздел "Плагины" в админке Shop-Script

### 2. Базовая настройка

Перейдите в **Магазин → Настройки → Prefill**:

1. **Включите плагин** - установите статус "Включен"
2. **Выберите витрины** - настройте для каждой витрины отдельно
3. **Сохраните изменения**

### 3. Проверка работы

1. Очистите кэш: `rm -rf wa-cache/apps/shop_prefill/`
2. Перейдите в корзину как покупатель
3. Проверьте предзаполнение полей

## Детальная настройка

### Общие настройки плагина

**Расположение:** Магазин → Настройки → Prefill → Общие

- **Статус плагина** - включение/отключение функциональности
- **Отладка** - включение режима отладки для разработчиков

### Настройки витрин

**Расположение:** Магазин → Настройки → Prefill → Витрины

#### Основные настройки

- **Активность** - включение предзаполнения для витрины
- **Предзаполнение активно** - автоматическое заполнение полей
- **Предзаполнение при входе** - заполнение при первом посещении

#### Запоминание пользователей

- **Запомнить меня** - сохранение данных гостевых пользователей
- **Время жизни куки** - период хранения данных (в днях)

#### Исключения

- **Отключить для полей** - поля, которые не нужно предзаполнять
- **Отключить для методов доставки** - исключения по способам доставки

#### Стили

- **Акцентный цвет** - цвет элементов интерфейса
- **CSS-переменные** - кастомизация внешнего вида

## Расширенная настройка

### Настройка через API

```php
// Получение настроек витрины
$settings = shopPrefillPlugin::getInstance()->getStorefrontSettings();

// Изменение настроек программно
shopPrefillPlugin::getInstance()->saveSettings([
    'storefront' => [
        'site.ru' => [
            'prefill' => [
                'active' => true,
                'on_entry' => false
            ]
        ]
    ]
]);
```

### Кастомизация источников данных

Плагин позволяет расширять источники данных для предзаполнения:

```php
class MyPrefillProvider extends shopPrefillPluginFillParamsProvider
{
    public function getAdditionalData(): array
    {
        // Логика получения дополнительных данных
        return ['custom_field' => 'value'];
    }
}
```

### Интеграция с внешними системами

Для интеграции с CRM или другими системами:

1. Реализуйте интерфейс `shopPrefillPluginFillParamsStorage`
2. Настройте экспорт/импорт данных
3. Добавьте хуки для синхронизации

## Диагностика проблем

### Поля не предзаполняются

1. Проверьте активность плагина
2. Убедитесь в наличии данных пользователя
3. Очистите кэш: `rm -rf wa-cache/apps/shop_prefill/`
4. Проверьте логи на ошибки

### Данные сохраняются некорректно

1. Проверьте права доступа к файлам
2. Убедитесь в корректности структуры БД
3. Проверьте версию PHP и MySQL
4. Включите режим отладки

### Конфликты с другими плагинами

1. Отключите другие плагины временно
2. Проверьте порядок загрузки плагинов
3. Изучите логи конфликтов
4. Обратитесь в поддержку

## Мониторинг и поддержка

### Логирование

Плагин ведет логи своей работы:

- **Путь к логам:** `wa-log/shop_prefill.log`
- **Уровни логирования:** ERROR, WARNING, INFO, DEBUG

### Метрики производительности

Мониторьте следующие показатели:

- Время предзаполнения полей
- Количество запросов к БД
- Размер данных в сессии
- Процент успешных предзаполнений

### Обновление плагина

При обновлении:

1. Создайте резервную копию настроек
2. Обновите файлы плагина
3. Запустите миграции БД (если есть)
4. Очистите кэш полностью
5. Протестируйте функциональность