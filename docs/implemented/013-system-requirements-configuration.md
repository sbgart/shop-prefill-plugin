# Добавление системных требований (requirements.php)

**Дата:** 2026-01-04  
**Тип:** Конфигурация  
**Приоритет:** Высокий  
**Статус:** Реализовано

## Проблема

Плагин не имел явно указанных минимальных системных требований к окружению:

- Отсутствовал файл `lib/config/requirements.php`
- Не было проверки минимальной версии PHP
- Не было проверки минимальной версии Shop-Script
- Пользователи могли устанавливать плагин на несовместимые версии

## Решение

Создан файл `lib/config/requirements.php` со следующими требованиями:

### Минимальная версия PHP: 7.4

**Обоснование:**

- Плагин использует современный синтаксис PHP
- PHP 7.4 обеспечивает необходимую производительность
- Версии ниже 7.4 не поддерживаются официально

### Минимальная версия Shop-Script: 9.0

**Обоснование:**

- Плагин использует Webasyst UI 2.0
- UI 2.0 стал стабильным начиная с Shop-Script 9.0
- Обеспечивает совместимость с современным интерфейсом

## Реализация

### Файл: `lib/config/requirements.php`

```php
<?php

return [
    // Минимальная версия PHP
    'php' => [
        'name' => 'PHP',
        'description' => 'Минимальная версия PHP для работы плагина',
        'strict' => true,
        'version' => '>=7.4',
    ],

    // Минимальная версия Shop-Script
    'app.shop' => [
        'name' => 'Shop-Script',
        'description' => 'Минимальная версия Shop-Script с поддержкой Webasyst UI 2.0',
        'strict' => true,
        'version' => '9.0',
    ],
];
```

## Параметры конфигурации

### Структура требования

Каждое требование содержит:

- **`name`** - название ресурса (отображается пользователю)
- **`description`** - описание и объяснение необходимости
- **`strict`** - обязательность наличия (`true` = блокирует установку при несоответствии)
- **`version`** - требуемая версия (поддерживает операторы сравнения: `>=`, `>`, `=`, `<=`, `<`)

### Параметр `strict: true`

При значении `true`:

- Установка плагина будет невозможна на несовместимых версиях
- Инсталлер Webasyst покажет ошибку с описанием требований
- Защищает от установки на неподдерживаемое окружение

## Преимущества

### 1. Защита от несовместимости

- Предотвращает установку на старые версии
- Избегает ошибок времени выполнения
- Улучшает пользовательский опыт

### 2. Явная документация требований

- Пользователи видят требования до установки
- Упрощает поддержку и диагностику
- Соответствует стандартам Webasyst

### 3. Автоматическая проверка

- Инсталлер проверяет требования автоматически
- Не требует ручной проверки версий
- Стандартный механизм Webasyst Framework

## Обновление документации

### README.md

Обновлен раздел "Требования":

```markdown
### Требования

- **PHP**: 7.4+
- **Webasyst**: 2.x
- **Shop-Script**: 9.0+ (требуется для поддержки Webasyst UI 2.0)
- **MySQL**: 5.7+
```

## Дополнительная информация

### Документация Webasyst

- [Системные требования](https://developers.webasyst.ru/docs/basics/system-requirements/)
- [Оформление requirements.php](https://developers.webasyst.ru/docs/cookbook/system-requirements/)

### Поддерживаемые типы требований

Webasyst поддерживает следующие типы требований:

- `php` - версия PHP
- `app.{app_id}` - версия приложения Webasyst
- `php.{extension}` - расширение PHP (например, `php.curl`)
- `phpini.{parameter}` - параметр конфигурации PHP (например, `phpini.max_execution_time`)

### Операторы сравнения версий

- `>=` - минимальная версия (включительно)
- `>` - больше указанной версии
- `=` - точная версия
- `<=` - максимальная версия (включительно)
- `<` - меньше указанной версии

## Рекомендации

### При добавлении новых требований

1. **Обосновывайте каждое требование** - указывайте причину в `description`
2. **Используйте `strict: true` для критичных требований** - PHP, приложения
3. **Используйте `strict: false` для рекомендаций** - параметры PHP, расширения
4. **Тестируйте на минимальных версиях** - убедитесь, что плагин работает
5. **Обновляйте документацию** - README.md и другие файлы

### Версионирование

При изменении требований:

- Увеличивайте версию плагина (минорную или мажорную)
- Документируйте изменения в CHANGELOG
- Уведомляйте пользователей о новых требованиях

## Тестирование

### Проверка требований

```bash
# Проверить синтаксис файла
php -l lib/config/requirements.php

# Проверить содержимое
php -r "print_r(include 'lib/config/requirements.php');"
```

### Ожидаемый результат

```
Array
(
    [php] => Array
        (
            [name] => PHP
            [description] => Минимальная версия PHP для работы плагина
            [strict] => 1
            [version] => >=7.4
        )
    [app.shop] => Array
        (
            [name] => Shop-Script
            [description] => Минимальная версия Shop-Script с поддержкой Webasyst UI 2.0
            [strict] => 1
            [version] => 9.0
        )
)
```

## Заключение

Добавление файла `requirements.php` - это важный шаг к профессиональному оформлению плагина:

- ✅ Соответствует стандартам Webasyst
- ✅ Защищает от установки на несовместимые версии
- ✅ Улучшает пользовательский опыт
- ✅ Упрощает поддержку и диагностику
- ✅ Документирует технические требования

Файл будет автоматически использоваться Инсталлером Webasyst при установке и обновлении плагина.
