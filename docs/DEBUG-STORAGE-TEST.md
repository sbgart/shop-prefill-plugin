# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è

## –¶–µ–ª—å

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Å –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π:
- –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö: –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î –ø–æ `contact_id`
- –î–ª—è –≥–æ—Å—Ç–µ–π: –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î –ø–æ —Ö–µ—à—É `prefill_guest_hash`

## –î–µ–±–∞–≥ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Å `shopPrefillPluginDebugHelper` (–Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `lib/classes/helpers/`):

- –õ–µ—Ç–∞—é—â–µ–µ –æ–∫–Ω–æ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–± –∏—Å—Ç–æ—á–Ω–∏–∫–µ –¥–∞–Ω–Ω—ã—Ö (order ID, guest hash, contact_id)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –í–∫–ª—é—á–∏—Ç–µ —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏

–í —Ñ–∞–π–ª–µ `wa-config/SystemConfig.class.php` —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:

```php
public static function isDebug()
{
    return true;
}
```

### 2. –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑)

1. –û—Ç–∫—Ä–æ–π—Ç–µ Incognito —Ä–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞
2. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é
3. –í –¥–µ–±–∞–≥ –æ–∫–Ω–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - `user_authorized: false`
   - `guest_hash: abc123...` (–∫–æ—Ä–æ—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è —Ö–µ—à–∞)
   - `orders_count: 0`
   - `source: empty (no orders)`
4. –û—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑
5. –°–Ω–æ–≤–∞ –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–µ–±–∞–≥ –æ–∫–Ω–æ:
   - `orders_count: 1`
   - `source: order`
   - `source_order_id: <ID –∑–∞–∫–∞–∑–∞>`
   - –î–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω—ã –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

- –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞ –¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –∏–∑ –ë–î
- –•–µ—à –≥–æ—Å—Ç—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –≤–∏–∑–∏—Ç–∞–º–∏ (cookie 1 –≥–æ–¥)

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

1. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –Ω–∞ —Å–∞–π—Ç–µ
2. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é
3. –í –¥–µ–±–∞–≥ –æ–∫–Ω–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - `user_authorized: true`
   - `contact_id: <ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è>`
   - `guest_hash: null`
   - `orders_count: <–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤>`
4. –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–∫–∞–∑—ã:
   - `source: order`
   - `source_order_id: <ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞>`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

- –î–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞ –ø–æ `contact_id`
- –•–µ—à –≥–æ—Å—Ç—è –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–∫–∞–∑–æ–≤ –≥–æ—Å—Ç—è

1. Incognito —Ä–µ–∂–∏–º
2. –û—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑ —Å –∞–¥—Ä–µ—Å–æ–º –ê
3. –û—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑ —Å –∞–¥—Ä–µ—Å–æ–º –ë
4. –¢—Ä–µ—Ç–∏–π —Ä–∞–∑ –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä ‚Üí —á–µ–∫–∞—É—Ç
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - `orders_count: 2`
   - –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω –∞–¥—Ä–µ—Å –ë (–∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

- –í—Å–µ –∑–∞–∫–∞–∑—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –æ–¥–Ω–æ–º—É —Ö–µ—à—É –≥–æ—Å—Ç—è
- –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–∫–∞–∑–∞

#### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ú–µ–Ω–µ–¥–∂–µ—Ä –∏—Å–ø—Ä–∞–≤–∏–ª –∑–∞–∫–∞–∑

1. –û—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑ —Å –∞–¥—Ä–µ—Å–æ–º "—É–ª. –õ–µ–Ω–∏–Ω–∞, 1"
2. –í –∞–¥–º–∏–Ω–∫–µ –∏–∑–º–µ–Ω–∏—Ç–µ –∞–¥—Ä–µ—Å –Ω–∞ "—É–ª. –õ–µ–Ω–∏–Ω–∞, 10"
3. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —á–µ–∫–∞—É—Ç—É
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

- –ü—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å "—É–ª. –õ–µ–Ω–∏–Ω–∞, 10"
- –î–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –±–µ—Ä—É—Ç—Å—è –∏–∑ –ë–î (–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ)

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î

### –ù–∞–π—Ç–∏ —Ö–µ—à –≥–æ—Å—Ç—è –≤ –∑–∞–∫–∞–∑–∞—Ö

```sql
SELECT order_id, value 
FROM shop_order_params 
WHERE name = 'prefill_guest_hash' 
ORDER BY order_id DESC 
LIMIT 10;
```

### –ù–∞–π—Ç–∏ –≤—Å–µ –∑–∞–∫–∞–∑—ã –ø–æ —Ö–µ—à—É

```sql
SELECT op.order_id, o.create_datetime, o.total 
FROM shop_order_params op
JOIN shop_order o ON o.id = op.order_id
WHERE op.name = 'prefill_guest_hash' 
  AND op.value = '<hash>'
ORDER BY op.order_id DESC;
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cookie

–í –±—Ä–∞—É–∑–µ—Ä–µ (DevTools ‚Üí Application ‚Üí Cookies):
- –ò–º—è: `prefill_guest_hash`
- –ó–Ω–∞—á–µ–Ω–∏–µ: SHA256 —Ö–µ—à (64 —Å–∏–º–≤–æ–ª–∞)
- HttpOnly: true
- Expires: —á–µ—Ä–µ–∑ 1 –≥–æ–¥

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ–±–∞–≥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

```
üîç PREFILL DEBUG

User Info:
‚îú‚îÄ authorized: true/false
‚îú‚îÄ contact_id: 123 (–¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö)
‚îú‚îÄ guest_hash: abc123... (–¥–ª—è –≥–æ—Å—Ç–µ–π)
‚îî‚îÄ orders_count: 5

Data Source:
‚îú‚îÄ source: order / empty
‚îî‚îÄ source_order_id: 456

Fill Params:
‚îú‚îÄ country: rus
‚îú‚îÄ city: –ú–æ—Å–∫–≤–∞
‚îú‚îÄ shipping_id: 1
‚îî‚îÄ payment_id: 2

Checkout Params (session):
‚îî‚îÄ order: {...}
```

## –ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–û—Ç–∫–ª—é—á–∏—Ç–µ debug —Ä–µ–∂–∏–º** –≤ `SystemConfig.class.php`
2. **–û—á–∏—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö | –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å |
|----------|-----------------|--------------|
| –ì–æ—Å—Ç—å, –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑ | –ü—É—Å—Ç–æ | ‚Äî |
| –ì–æ—Å—Ç—å, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤–∏–∑–∏—Ç | –ë–î –ø–æ —Ö–µ—à—É | –í—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ |
| –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π | –ë–î –ø–æ contact_id | –í—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ |
| –ú–µ–Ω–µ–¥–∂–µ—Ä –∏—Å–ø—Ä–∞–≤–∏–ª –∑–∞–∫–∞–∑ | –ë–î | –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è |
